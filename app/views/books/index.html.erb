<html>
<head>
<style>
  body {
  background-color: #E6E6FA;
  }

a:link, a:visited {
  background-color: white;
  color: black;
  border: 2px solid green;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
}
a:hover, a:active {
  background-color: green;
  color: white;
}
</style>
</head>
<body>
  <%= button_to "Powrót do strony głównej", root_path, :method => :get %><br/>
  <% if current_user.role == "Bibliotekarz"%>
  <%= button_to "Uzytkownicy wypożyczający", return_path, :method => :get %><br/>
  <% end %>
<%= form_tag(search_path, :method => "get") do %>
<div class="input-group">
	<%= search_field_tag :search, params[:search], placeholder: "Znajdź książkę ", class: "form-control" %>
	<div class="input-group-btn">
		<%= button_tag "Szukaj", :class => 'btn btn-info glyphicon glyphicon-search', 
    :title => nil%>
	</div>
</div>
<% end %>

  <% if current_user.role != "Użytkownik" %>
    <%= button_to "Dodaj książkę", newbook_path, :method => :get %>

  <% end %>
  <h1>Książki:</h1>
<table style="border-collapse: separate; border-spacing: 10px;">
  <thead>
    <tr>
      <th style="border-bottom: 2px solid black;">Tytuł</th>
      <th style="border-bottom: 2px solid black;">Autor</th>
      <th style="border-bottom: 2px solid black;">Gatunek</th>
    </tr>
  </thead>
  <tbody>
    <% @books.each do |book| %>
      <tr>
        <td style="border-bottom: 1px solid black;">
          <a href="/books/<%= book.id %>">
            <%= book.title %>
          </a>
        </td>
        <td style="border-bottom: 1px solid black;">
          <%= book.author %>
        </td>
        <td style="border-bottom: 1px solid black;">
          <%= book.genre %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>


<% @borrowed_books.each do |copy| %>
  <h3><%= copy.book.title %></h3>
  <ul>
    <% copy.borrowings.each do |borrowing| %>
      <li>
        <strong>Tytuł: <%= borrowing.copy.book.title %></strong>
        <br>
        <strong>ID: <%= borrowing.copy.id %></strong>
        <br>
        Data wypożyczenia: <%= borrowing.borrow_date %>
        <br>
        Data do zwrotu: <%= borrowing.due_date %>
        <br>
        Zwrócona: <%= borrowing.returned ? 'Tak' : 'Nie' %>
        <br>
       <% if !borrowing.returned && !borrowing.renewal_request? %>
          <%= form_with(model: [@book, @copy, borrowing], local: true) do |form| %>
            <%= form.hidden_field :renewal_request, value: 'true' %>
            <%= form.label :due_date, "Nowa data zwrotu" %>
            <%= form.date_field :due_date, required: true, min: borrowing.due_date + 1.day, max: (borrowing.due_date + 14.days), value: borrowing.due_date + 1.day, id: 'due_date' %>
            <div>
              <%= form.submit "Przedłuż wypożyczenie", data: { turbo_stream_frame: 'reload', turbo_confirm: 'Czy na pewno chcesz zatwierdzić ten profil?' }%>
            </div><br/> 
          <% end %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% end %>

<% if flash[:alert].present? %>
  <div class="alert alert-danger">
    <%= flash[:alert] %>
  </div>
<% end %>
</body>

